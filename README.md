# icmp-reply
ICMP reply daemon written in C

# Dependencies
```
sudo apt-get install iptables-persistent libnetfilter-log-dev
```

# Build
```
gcc icmp-reply.c -o icmp-reply -l netfilter_log
```

# Run
Remember you need to run icmp-reply as sudo

Your /etc/iptables/rules.v4 should look like this

```
# Generated by iptables-save v1.6.0 on Wed Nov 15 18:56:35 2017
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# accept SSH
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
# send incoming ping request to netfilter
-A INPUT -p icmp --icmp-type echo-request -j NFLOG
# then drop them, so that the kernel won't reply (but our process will)
-A INPUT -p icmp --icmp-type echo-request -j DROP
# allow incoming traffic related to connections initiated by me
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
# drop everything else
-A INPUT -j DROP
COMMIT
# Completed on Wed Nov 15 18:56:35 2017
```

After you've modified your iptables rules, remember to do an iptables-restore

```
sudo iptables-restore < /etc/iptables/rules.v4
```

If you want the daemon to run at system boot, build icmp-reply and place it in /usr/sbin/icmp-reply, then create the file /etc/systemd/system/icmp-reply.service similar to this:

```
[Unit]
Description=ICMP Reply

[Service]
User=root
Restart=always
Type=simple
ExecStart=/usr/sbin/icmp-reply
StandardOutput=journal

[Install]
WantedBy=multi-user.target
```

And enable the service with

```
sudo systemctl enable icmp-reply
```
